<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Talk2Translate</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #0ea5e9, #22d3ee);
    margin: 0; padding: 20px; color: white;
    text-align: center;
  }
  h1 { margin-bottom: 20px; }
  select, button {
    padding: 10px;
    border-radius: 8px;
    border: none;
    font-size: 14px;
    margin: 5px;
  }
  button {
    background: #ff4d8d; color: white; cursor: pointer;
  }
  button:disabled { background: gray; cursor: not-allowed; }
  .box {
    background: rgba(0,0,0,0.3);
    padding: 10px; border-radius: 8px;
    min-height: 60px; margin: 10px auto; max-width: 500px;
  }
</style>
</head>
<body>

<h1>🎤 Talk2Translate</h1>

<div>
  Kaynak Dil:
  <select id="sourceLang">
    <option value="tr-TR" data-iso="tr">Türkçe</option>
    <option value="en-US" data-iso="en">İngilizce</option>
    <option value="de-DE" data-iso="de">Almanca</option>
    <option value="fr-FR" data-iso="fr">Fransızca</option>
    <option value="es-ES" data-iso="es">İspanyolca</option>
  </select>

  Hedef Dil:
  <select id="targetLang">
    <option value="en">İngilizce</option>
    <option value="tr">Türkçe</option>
    <option value="de">Almanca</option>
    <option value="fr">Fransızca</option>
    <option value="es">İspanyolca</option>
  </select>
</div>

<div>
  <button id="startBtn">🎙 Dinlemeyi Başlat</button>
  <button id="stopBtn" disabled>⏹ Durdur</button>
  <button id="speakBtn" disabled>🔊 Sesle Oku</button>
</div>

<h3>Algılanan Metin</h3>
<div class="box" id="recognizedText">—</div>

<h3>Çevrilen Metin</h3>
<div class="box" id="translatedText">—</div>

<script>
const recognizedText = document.getElementById("recognizedText");
const translatedText = document.getElementById("translatedText");
const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const speakBtn = document.getElementById("speakBtn");
const sourceLang = document.getElementById("sourceLang");
const targetLang = document.getElementById("targetLang");

let recognition;
let lastTranslated = "";

startBtn.addEventListener("click", () => {
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SR) {
    alert("Tarayıcınız ses tanımayı desteklemiyor.");
    return;
  }
  recognition = new SR();
  recognition.lang = sourceLang.value;
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.onstart = () => {
    recognizedText.textContent = "Dinleniyor...";
    startBtn.disabled = true;
    stopBtn.disabled = false;
  };
  recognition.onresult = (e) => {
    const transcript = e.results[0][0].transcript;
    recognizedText.textContent = transcript;
    translateText(transcript, sourceLang.selectedOptions[0].dataset.iso, targetLang.value);
  };
  recognition.onerror = (e) => {
    recognizedText.textContent = "Hata: " + e.error;
  };
  recognition.onend = () => {
    startBtn.disabled = false;
    stopBtn.disabled = true;
  };
  recognition.start();
});

stopBtn.addEventListener("click", () => {
  if (recognition) recognition.stop();
});

async function translateText(text, sourceISO, targetISO) {
  translatedText.textContent = "Çevriliyor...";
  try {
    const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${sourceISO}|${targetISO}`);
    const data = await res.json();
    const out = data.responseData.translatedText;
    translatedText.textContent = out;
    lastTranslated = out;
    speakBtn.disabled = false;
  } catch {
    translatedText.textContent = "Çeviri hatası!";
    speakBtn.disabled = true;
  }
}

speakBtn.addEventListener("click", () => {
  if (!lastTranslated) return;
  const utterance = new SpeechSynthesisUtterance(lastTranslated);
  utterance.lang = targetLang.value;
  speechSynthesis.speak(utterance);
});
</script>

</body>
</html>
