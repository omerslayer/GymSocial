<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Talk2Translate ‚Äî Modern</title>
<style>
  :root{
    --bg1:#0b1220; --bg2:#0e1b2e; --glass:rgba(255,255,255,.08);
    --ink:#e9eef7; --muted:#a7b2c7; --brand:#6ee7ff; --accent:#ff6aa7;
    --ok:#34d399; --warn:#fbbf24; --err:#f87171; --line:rgba(255,255,255,.12);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial;
    background:
      radial-gradient(1200px 800px at 80% -10%, #1c2f4d 0%, transparent 60%),
      radial-gradient(900px 600px at -10% 90%, #213b5f 0%, transparent 55%),
      linear-gradient(180deg,var(--bg1),var(--bg2));
    display:flex; align-items:center; justify-content:center; padding:20px;
  }
  .wrap{
    width:min(980px,100%); padding:20px;
  }
  .card{
    background:var(--glass); border:1px solid var(--line);
    border-radius:18px; padding:18px; backdrop-filter: blur(16px);
    box-shadow: 0 20px 60px rgba(0,0,0,.35);
  }
  header{
    display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    margin-bottom:14px;
  }
  .title{
    display:flex; align-items:center; gap:10px; letter-spacing:.2px;
  }
  .logo{
    width:36px;height:36px;border-radius:10px;
    background:linear-gradient(135deg,#77e4ff,#a28bff);
    display:grid;place-items:center;color:#0a0f1a;font-weight:700;
    box-shadow:0 6px 24px rgba(119,228,255,.35);
  }
  h1{font-size:22px;margin:0}
  .badges{display:flex;gap:8px;flex-wrap:wrap}
  .badge{
    font-size:12px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.07);
    border:1px solid var(--line)
  }
  .ok{background:rgba(52,211,153,.18); color:#d1fae5}
  .warn{background:rgba(251,191,36,.18); color:#fef3c7}
  .err{background:rgba(248,113,113,.18); color:#fee2e2}

  .panel{
    display:grid; grid-template-columns:1fr 1fr; gap:14px;
  }
  @media (max-width:860px){ .panel{grid-template-columns:1fr} }

  .tool{
    display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    background:rgba(255,255,255,.05);
    border:1px dashed var(--line); padding:10px; border-radius:14px;
  }
  select, button, textarea, input[type="text"]{
    border:none; border-radius:12px; padding:11px 12px; font-size:15px;
    color:var(--ink); background:rgba(255,255,255,.09); outline:none;
    transition:transform .05s ease;
  }
  select{min-width:170px}
  button{cursor:pointer; background:linear-gradient(135deg,var(--accent),#b56bff); font-weight:600}
  button.secondary{background:rgba(255,255,255,.09); border:1px solid var(--line); font-weight:500}
  button:disabled{opacity:.55; cursor:not-allowed}
  button:active{transform:scale(.98)}

  .grid{
    display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-top:14px;
  }
  @media (max-width:860px){ .grid{grid-template-columns:1fr} }
  .box{
    background:rgba(255,255,255,.06); border:1px solid var(--line);
    border-radius:16px; padding:12px; min-height:120px; display:flex; flex-direction:column; gap:8px;
  }
  .box h3{margin:0;color:var(--muted); font-size:14px; letter-spacing:.2px}
  .box .view{
    flex:1; background:rgba(0,0,0,.25); border-radius:12px; padding:12px;
    overflow:auto; word-break:break-word; line-height:1.5;
  }
  .manual{margin-top:14px}
  textarea{width:100%; min-height:90px; resize:vertical}
  .bar{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:10px}
  footer{margin-top:14px; color:var(--muted); font-size:12px; text-align:center}
  .hint{color:var(--brand)}
  .switch{display:flex; gap:8px; align-items:center; background:rgba(255,255,255,.07); border:1px solid var(--line); border-radius:999px; padding:6px 10px; font-size:13px}
  .inline{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="title">
          <div class="logo">T2</div>
          <div>
            <h1>Talk2Translate</h1>
            <div style="font-size:12px;color:var(--muted)">Canlƒ± konu≈ü ‚Äî anƒ±nda √ßevir ‚Äî hedef dilde seslendir</div>
          </div>
        </div>
        <div class="badges">
          <span id="httpsBadge" class="badge">HTTPS kontrol ediliyor‚Ä¶</span>
          <span id="srBadge" class="badge">SpeechRecognition kontrol√º‚Ä¶</span>
          <span id="micBadge" class="badge">Mikrofon izni bekleniyor‚Ä¶</span>
        </div>
      </header>

      <div class="tool">
        <div class="inline">
          <span style="opacity:.8">Kaynak</span>
          <select id="sourceLang">
            <option value="tr-TR" data-iso="tr" selected>T√ºrk√ße</option>
            <option value="en-US" data-iso="en">ƒ∞ngilizce</option>
            <option value="de-DE" data-iso="de">Almanca</option>
            <option value="fr-FR" data-iso="fr">Fransƒ±zca</option>
            <option value="es-ES" data-iso="es">ƒ∞spanyolca</option>
            <option value="ar-SA" data-iso="ar">Arap√ßa</option>
            <option value="ru-RU" data-iso="ru">Rus√ßa</option>
          </select>
        </div>

        <div class="inline">
          <span style="opacity:.8">Hedef</span>
          <select id="targetLang">
            <option value="en" selected>ƒ∞ngilizce</option>
            <option value="tr">T√ºrk√ße</option>
            <option value="de">Almanca</option>
            <option value="fr">Fransƒ±zca</option>
            <option value="es">ƒ∞spanyolca</option>
            <option value="ar">Arap√ßa</option>
            <option value="ru">Rus√ßa</option>
          </select>
        </div>

        <div class="inline" style="margin-left:auto">
          <button id="startBtn">üéô Ba≈ülat</button>
          <button id="stopBtn" class="secondary" disabled>‚èπ Durdur</button>
          <label class="switch">
            <input type="checkbox" id="autoSpeak" checked style="accent-color:#fff"> otomatik oku
          </label>
          <button id="speakBtn" class="secondary" disabled>üîä Oku</button>
        </div>
      </div>

      <div class="grid">
        <div class="box">
          <h3>Algƒ±lanan Metin</h3>
          <div id="recognizedText" class="view">‚Äî</div>
        </div>
        <div class="box">
          <h3>√áevrilen Metin</h3>
          <div id="translatedText" class="view">‚Äî</div>
        </div>
      </div>

      <div class="box manual">
        <h3>Manuel Mod</h3>
        <textarea id="manualInput" placeholder="Metni yazƒ±n ve √áevir‚Äôe basƒ±n‚Ä¶"></textarea>
        <div class="bar">
          <button id="manualTranslateBtn">√áevir</button>
          <span id="lastError" class="badge">Son hata: yok</span>
          <span class="hint">ƒ∞pucu: iOS Safari konu≈üma tanƒ±mayƒ± desteklemez.</span>
        </div>
      </div>

      <footer>
        √úcretsiz √ßeviri: MyMemory ‚Ä¢ En iyi sonu√ß i√ßin Chrome/Edge + HTTPS (GitHub Pages) kullanƒ±n.
      </footer>
    </div>
  </div>

<script>
  // === Elementler ===
  const recognizedEl = document.getElementById('recognizedText');
  const translatedEl = document.getElementById('translatedText');
  const startBtn = document.getElementById('startBtn');
  const stopBtn = document.getElementById('stopBtn');
  const speakBtn = document.getElementById('speakBtn');
  const autoSpeak = document.getElementById('autoSpeak');
  const manualInput = document.getElementById('manualInput');
  const manualTranslateBtn = document.getElementById('manualTranslateBtn');
  const sourceSel = document.getElementById('sourceLang');
  const targetSel = document.getElementById('targetLang');
  const httpsBadge = document.getElementById('httpsBadge');
  const srBadge = document.getElementById('srBadge');
  const micBadge = document.getElementById('micBadge');
  const lastErrorEl = document.getElementById('lastError');

  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;

  // === rozet yardƒ±mcƒ±larƒ± ===
  const setBadge = (el, text, cls) => { el.className = `badge ${cls||''}`; el.textContent = text; };
  const setError = (msg) => lastErrorEl.textContent = `Son hata: ${msg}`;

  // HTTPS kontrol
  const isHttps = location.protocol === 'https:' || ['localhost','127.0.0.1'].includes(location.hostname);
  setBadge(httpsBadge, isHttps ? 'HTTPS ‚úî' : 'HTTPS gerekli (GitHub Pages √∂nerilir)', isHttps ? 'ok' : 'warn');

  // SpeechRecognition desteƒüi
  if (SR) setBadge(srBadge, 'SpeechRecognition destekleniyor ‚úî', 'ok');
  else setBadge(srBadge, 'SpeechRecognition desteklenmiyor', 'err');

  // Mikrofon izni
  navigator.mediaDevices?.getUserMedia?.({audio:true})
    .then(()=> setBadge(micBadge,'Mikrofon izni verildi ‚úî','ok'))
    .catch(()=> setBadge(micBadge,'Mikrofon izni yok','err'));

  // === √áeviri ‚Äî MyMemory ===
  async function translateText(text, sourceISO, targetISO) {
    translatedEl.textContent = '√áevriliyor‚Ä¶';
    try{
      const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${sourceISO}|${targetISO}`;
      const res = await fetch(url);
      const data = await res.json();
      let out = (data?.responseData?.translatedText || '').trim();
      if (!out && Array.isArray(data?.matches) && data.matches.length){
        // bazen matches i√ßinde daha iyi sonu√ß olur
        out = (data.matches[0].translation || '').trim();
      }
      if (!out) throw new Error('Bo≈ü √ßeviri d√∂nd√º');
      translatedEl.textContent = out;
      lastTranslated = out;
      speakBtn.disabled = false;
      setError('yok');
      if (autoSpeak.checked) speakNow();
    }catch(e){
      translatedEl.textContent = '√áeviri hatasƒ±!';
      speakBtn.disabled = true;
      setError(e.message || '√áeviri hatasƒ±');
    }
  }

  // === Sesle okuma ===
  let lastTranslated = '';
  function speakNow(){
    if (!lastTranslated) return;
    const u = new SpeechSynthesisUtterance(lastTranslated);
    u.lang = targetSel.value; // en, tr, de...
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  }
  speakBtn.addEventListener('click', speakNow);

  // === Manuel mod ===
  manualTranslateBtn.addEventListener('click', ()=>{
    const text = manualInput.value.trim();
    if (!text) return;
    recognizedEl.textContent = text;
    const srcISO = sourceSel.selectedOptions[0].dataset.iso; // tr, en...
    const tgtISO = targetSel.value;
    translateText(text, srcISO, tgtISO);
  });

  // === Canlƒ± dinleme ===
  let recognition = null;

  startBtn.addEventListener('click', async ()=>{
    if (!SR){ setError('Tarayƒ±cƒ± desteklemiyor'); alert('Tarayƒ±cƒ±nƒ±z ses tanƒ±mayƒ± desteklemiyor.'); return; }

    // kullanƒ±cƒ± etkile≈üimi ile izin al
    try { await navigator.mediaDevices.getUserMedia({audio:true}); setBadge(micBadge,'Mikrofon izni verildi ‚úî','ok'); }
    catch { setBadge(micBadge,'Mikrofon izni yok','err'); setError('Mikrofon izni verilmedi'); return; }

    recognition = new SR();
    recognition.lang = sourceSel.value; // tr-TR, en-US...
    recognition.interimResults = true;
    recognition.maxAlternatives = 1;

    recognition.onstart = ()=>{
      recognizedEl.textContent = 'Dinleniyor‚Ä¶';
      startBtn.disabled = true; stopBtn.disabled = false;
    };

    recognition.onresult = (e)=>{
      const txt = Array.from(e.results).map(r=>r[0].transcript).join(' ');
      recognizedEl.textContent = txt || '‚Äî';
      // final olduƒüunda √ßevir
      if (e.results[e.results.length-1].isFinal){
        const srcISO = sourceSel.selectedOptions[0].dataset.iso;
        const tgtISO = targetSel.value;
        translateText(txt, srcISO, tgtISO);
      }
    };

    recognition.onerror = (e)=>{
      recognizedEl.textContent = `Hata: ${e.error}`;
      setError(e.error || 'tanƒ±ma hatasƒ±');
    };

    recognition.onend = ()=>{
      startBtn.disabled = false; stopBtn.disabled = true;
    };

    recognition.start();
  });

  stopBtn.addEventListener('click', ()=>{
    if (recognition){ try{ recognition.stop(); }catch{} }
  });

  // Kaynak ve hedef aynƒ± olursa hedefi otomatik deƒüi≈ütir
  sourceSel.addEventListener('change', ()=>{
    const src = sourceSel.selectedOptions[0].dataset.iso;
    if (src === targetSel.value){
      targetSel.value = (src === 'en') ? 'tr' : 'en';
    }
  });
</script>
</body>
</html>
